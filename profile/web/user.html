<!--
	Author: W3layouts
	Author URL: http://w3layouts.com
	License: Creative Commons Attribution 3.0 Unported
	License URL: http://creativecommons.org/licenses/by/3.0/
-->
<!DOCTYPE html>
<html lang="en">

<head>
	<script src="jquery-3.5.1.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<!-- LIFF v1只能用到2021年4月 https://developers.line.biz/en/docs/liff/versioning-policy/ -->
	<!-- LIFF v2從2019年10月啟用 https://developers.line.biz/en/docs/liff/developing-liff-apps/#developing-a-liff-app -->
	<script src="https://static.line-scdn.net/liff/edge/versions/2.3.0/sdk.js"></script>
	<title>使用者資料設定</title>
	<!-- Meta tag Keywords -->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords"
		content="User Profile Form A Responsive Widget,Login form widgets, Sign up Web forms , Login signup Responsive web form,Flat Pricing table,Flat Drop downs,Registration Forms,News letter Forms,Elements" />
	<script type="application/x-javascript">
		addEventListener("load", function () {
			setTimeout(hideURLbar, 0);
		}, false);

		function hideURLbar() {
			window.scrollTo(0, 1);
		}
	</script>
	<!-- Meta tag Keywords -->
	<!-- css files -->
	<link href="css/style.css" rel="stylesheet" type="text/css" media="all">
	<link rel="stylesheet" href="css/font-awesome.css"> <!-- Font-Awesome-Icons-CSS -->
	<!-- //css files -->
	<!-- online-fonts -->

	<!--//online-fonts -->
	<!--//////init firebase-->
	<script src="/firebase-app.js"></script>
	<script src="/firebase-analytics.js"></script>
	<script src="/firebase-database.js"></script>
	<script>
		//firebase init app
		var firebaseConfig = {
			apiKey: "AIzaSyBXd4P9GdCXeiWD5n-VZlpVMsDCFoOUDYM",
			authDomain: "forchartjs.firebaseapp.com",
			databaseURL: "https://forchartjs.firebaseio.com"
		};
		// Initialize Firebase
		firebase.initializeApp(firebaseConfig);
	</script>






</head>

<body>

	<div class="header">
		<h1>使用者資料</h1>
	</div>
	<div class="w3-main">
		<div class="edit-btn">
			<button id="edit" onclick="edit_profile()">編輯</button>
			<script>
				function edit_profile() {
					document.getElementById("myName").disabled = false;
					document.getElementById("myage").disabled = false;
					document.getElementById("edit_done").disabled = false;
					//console.log("edit click !")

				}
			</script>
		</div>
		<div class="form-w3l">

			<div class="img">
				<img id=profile_img src="./images/profile.jpg" alt="image">
				<h2 id='username' style="color: black;"></h2>
			</div>
			<!--姓名-->
			<div class="w3l-user">
				<span><i class="fa fa-user-circle-o w3l-1" aria-hidden="true"></i></span>
				<input type="text" id="myName" disabled name="name" placeholder="姓名預設" required="" />
				<div class="clear"></div>
			</div>

			<!--年齡-->
			<div class="w3l-user">
				<span><i class="fa fa-address-card-o w3l-1" aria-hidden="true"></i></span>
				<input type="text" id="myage" disabled name="age" placeholder="年齡預設" required="" />
				<div class="clear"></div>
			</div>

			<!--城市(選)-->
			<div class="w3l-user">
				<span><i class="fa fa-home w3l-1" aria-hidden="true"></i></span>
				<select name="city" id="city" style="width: 150px;">
					<option>請選擇所在城市</option>
					<option>台北市</option>
					<option>新北市</option>
					<option>桃園市</option>
					<option>台中市</option>
					<option>台南市</option>
					<option>高雄市</option>
					<option>新竹縣</option>
					<option>苗栗縣</option>
					<option>彰化縣</option>
					<option>南投縣</option>
					<option>雲林縣</option>
					<option>嘉義縣</option>
					<option>屏東縣</option>
					<option>宜蘭縣</option>
					<option>花蓮縣</option>
					<option>台東縣</option>
					<option>澎湖縣</option>
					<option>金門縣</option>
					<option>連江縣</option>
					<option>基隆市</option>
					<option>新竹市</option>
					<option>嘉義市</option>


				</select>
				<div class="clear"></div>
			</div>

			<!--學歷-->
			<div class="w3l-user">
				<span><i class="fa fa-graduation-cap w3l-1" aria-hidden="true"></i></span>
				<select name="study" id="study" style="width: 150px;">
					<option>請選擇你學歷</option>
					<option>國小</option>
					<option>國高中</option>
					<option>大專學院</option>
					<option>研究所以上</option>

				</select>
				<div class="clear"></div>
			</div>

			<!--旅行目標(選)-->
			<div class="w3l-user">
				<span><i class="fa fa-address-card-o w3l-1" aria-hidden="true"></i></span>
				<select name="goal" id="goal" style="width: 150px;">
					<option>請選擇你旅行目的</option>
					<option>休閒觀光</option>
					<option>學習</option>

				</select>
				<div class="clear"></div>
			</div>

			<!--語言-->
			<div class="w3l-user">
				<span><i class="fa fa-language w3l-1" aria-hidden="true"></i></span>
				<select name="lan" id="lan" style="width: 150px;">
					<option>請選擇你語言</option>
					<option>英文</option>
					<option>中文</option>

				</select>
				<div class="clear"></div>
			</div>

			<!--職業-->
			<div class="w3l-user">
				<span><i class="fa fa-briefcase w3l-1" aria-hidden="true"></i></span>
				<select name="occ" id="occ" style="width: 150px;">
					<option>請選擇你職業</option>
					<option>學生</option>
					<option>軍警</option>
					<option>公務人員</option>
					<option>教育</option>
					<option>商</option>
					<option>工</option>
					<option>農</option>
					<option>醫療</option>
					<option>服務業</option>
					<option>家管</option>
					<option>退休</option>
				</select>
				<div class="clear"></div>
			</div>
			<!--是否有身心障礙-->
			<div class="w3l-user">
				<span><i class="fa fa-briefcase w3l-1" aria-hidden="true"></i></span>
				<select name="ICD" id="ICD" style="width: 150px;">
					<option>是否有身心障礙疾病</option>
					<option>是</option>
					<option>否</option>

				</select>
				<div class="clear"></div>
			</div>
			<div class="w3l-btn">
				<input type="submit" id="edit_done" onclick="edit_done()" disabled name="button" value="確認修改" />
			</div>

		</div>
	</div>
	<script>
		//主程式
		var login_check = "0";
		var user_conut = "";
		var guide_name = "";
		var guide_tel = "";
		var userId = ""; //測試資料
		var liffID = '1655371574-GnRlDL6R';
		async function main() {
			await liff.init({
				liffId: liffID
			})

			if (liff.isLoggedIn()) {

				liff.getProfile()
					.then(profile => {
						document.getElementById("profile_img").src = profile.pictureUrl
						document.getElementById("username").append(profile.displayName)
						userId = profile.userId;

						//比對資料庫做驗證
						firebase.database().ref('User/').on("value", function (snapshot) {

							console.log(userId);
							snapshot.forEach(function (item) {
								//console.log(item.val().userID);
								if (item.val().userID === userId) {
									console.log("找到了")
									login_check = "1";

								}
							})
						}).then(function () {
							if (login_check === "1") {
								alert("已經成功驗證，點擊右上編輯按鈕即可開始修改資料");
								//已經驗證登錄 可以修改資料了 !
								firebase.database().ref('User/user_conut').on("value", function (snapshot) {
									user_conut = snapshot.val();
								})

							} else {
								alert("未獲得權限，請先建立一份您的個人資料 !");

							}
						})












					})




			} else {
				liff.login()
			}
		}
		main()
		edit_done = function () {
			firebase.database().ref('User/user_count').on("value", function (snapshot) {
				user_conut = snapshot.val();
			})
			console.log(user_conut)
			firebase.database().ref('User/' + user_conut).update({
				ICD_tag: document.getElementById('ICD').value,
				Tour_ID: "",
				age: document.getElementById('myage').value,
				city: document.getElementById('city').value,
				education: document.getElementById('study').value,
				goal: document.getElementById('goal').value,
				guide_ID: "",
				lan: document.getElementById('lan').value,
				name: document.getElementById('myName').value,
				occupation: document.getElementById('occ').value,
				userID: userId


			}).then(function(){	
				user_conut = user_conut + 1;
				firebase.database().ref('User/').update({user_count:user_conut})
				alert("你已經成功更新資料 !")
			})
			
			
			
			liff.closeWindow();

		}
	</script>

	<footer>

	</footer>
</body>

</html>