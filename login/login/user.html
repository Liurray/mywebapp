<!DOCTYPE html>
<html lang="en">

<head>
	<title>導覽通驗證頁面</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!--//////init firebase-->
	<script src="/firebase-app.js"></script>
	<script src="/firebase-analytics.js"></script>
	<script src="/firebase-database.js"></script>
	<script>
		//firebase init app
		var firebaseConfig = {
			apiKey: "AIzaSyBXd4P9GdCXeiWD5n-VZlpVMsDCFoOUDYM",
			authDomain: "forchartjs.firebaseapp.com",
			databaseURL: "https://forchartjs.firebaseio.com"
		};
		// Initialize Firebase
		firebase.initializeApp(firebaseConfig);
	</script>



	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
	<!-- LIFF v1只能用到2021年4月 https://developers.line.biz/en/docs/liff/versioning-policy/ -->
	<!-- LIFF v2從2019年10月啟用 https://developers.line.biz/en/docs/liff/developing-liff-apps/#developing-a-liff-app -->
	<script src="https://static.line-scdn.net/liff/edge/versions/2.3.0/sdk.js"></script>
	<!--===============================================================================================-->
	<link rel="icon" type="image/png" href="images/icons/favicon.ico" />
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/iconic/css/material-design-iconic-font.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animsition/css/animsition.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/daterangepicker/daterangepicker.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="css/util.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
	<!--===============================================================================================-->

	<div id="dropDownSelect1"></div>

	<!--===============================================================================================-->
	<script src="vendor/jquery/jquery-3.2.1.min.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/animsition/js/animsition.min.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/bootstrap/js/popper.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/select2/select2.min.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/daterangepicker/moment.min.js"></script>
	<script src="vendor/daterangepicker/daterangepicker.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/countdowntime/countdowntime.js"></script>
	<!--===============================================================================================-->

</head>



<body>
	<div class="limiter" id="login_page" style="display: block;">
		<div class="container-login100">
			<div class="wrap-login100 p-t-85 p-b-20">

				<span class="login100-title p-b-70" id='username'>
					<!--使用者名稱顯示在這-->
				</span>
				<span class="login100-avatar">
					<img id="profile_img" alt="AVATAR">
					<!--使用者個人照片-->
				</span>



				<span class="login100-title p-b-900">
					<font size="6" id='login_result'></font>
					<!--驗證結果顯示在這-->
					<p id='UID'></p>
				</span>
				<div class="container-login100-btn">
					<button class="login100-btn" id='login_btn' style="display: none;" onclick="login()">
						確定登入
					</button>
				</div>




				</ul>

			</div>
		</div>
	</div>
	<div id = "profile" style="display: none;">
		<div class="header">
			<h1>使用者資料</h1>
		</div>
	
		<div class="w3-main">
			<div class="edit-btn">
				<button id="edit" onclick="edit_profile()">編輯</button>
				<script>
					function edit_profile() {
						document.getElementById("myName").disabled = false;
						document.getElementById("myage").disabled = false;
						document.getElementById("edit_done").disabled = false;
						//console.log("edit click !")
	
					}
				</script>
			</div>
			<div class="form-w3l">
	
				<div class="img">
					<img id=profile_img src="./images/profile.jpg" alt="image">
					<h2 id='username' style="color: black;"></h2>
				</div>
				<!--姓名-->
				<div class="w3l-user">
					<span><i class="fa fa-user-circle-o w3l-1" aria-hidden="true"></i></span>
					<input type="text" id="myName" disabled name="name" placeholder="姓名預設" required="" />
					<div class="clear"></div>
				</div>
	
				<!--年齡-->
				<div class="w3l-user">
					<span><i class="fa fa-address-card-o w3l-1" aria-hidden="true"></i></span>
					<input type="text" id="myage" disabled name="age" placeholder="年齡預設" required="" />
					<div class="clear"></div>
				</div>
	
				<!--城市(選)-->
				<div class="w3l-user">
					<span><i class="fa fa-home w3l-1" aria-hidden="true"></i></span>
					<select name="city" id="city" style="width: 150px;">
						<option>請選擇所在城市</option>
						<option>台北市</option>
						<option>新北市</option>
						<option>桃園市</option>
						<option>台中市</option>
						<option>台南市</option>
						<option>高雄市</option>
						<option>新竹縣</option>
						<option>苗栗縣</option>
						<option>彰化縣</option>
						<option>南投縣</option>
						<option>雲林縣</option>
						<option>嘉義縣</option>
						<option>屏東縣</option>
						<option>宜蘭縣</option>
						<option>花蓮縣</option>
						<option>台東縣</option>
						<option>澎湖縣</option>
						<option>金門縣</option>
						<option>連江縣</option>
						<option>基隆市</option>
						<option>新竹市</option>
						<option>嘉義市</option>
	
	
					</select>
					<div class="clear"></div>
				</div>
	
				<!--學歷-->
				<div class="w3l-user">
					<span><i class="fa fa-graduation-cap w3l-1" aria-hidden="true"></i></span>
					<select name="study" id="study" style="width: 150px;">
						<option>請選擇你學歷</option>
						<option>國小</option>
						<option>國高中</option>
						<option>大專學院</option>
						<option>研究所以上</option>
	
					</select>
					<div class="clear"></div>
				</div>
	
				<!--旅行目標(選)-->
				<div class="w3l-user">
					<span><i class="fa fa-address-card-o w3l-1" aria-hidden="true"></i></span>
					<select name="goal" id="goal" style="width: 150px;">
						<option>請選擇你旅行目的</option>
						<option>休閒觀光</option>
						<option>學習</option>
	
					</select>
					<div class="clear"></div>
				</div>
	
				<!--語言-->
				<div class="w3l-user">
					<span><i class="fa fa-language w3l-1" aria-hidden="true"></i></span>
					<select name="lan" id="lan" style="width: 150px;">
						<option>請選擇你語言</option>
						<option>英文</option>
						<option>中文</option>
	
					</select>
					<div class="clear"></div>
				</div>
	
				<!--職業-->
				<div class="w3l-user">
					<span><i class="fa fa-briefcase w3l-1" aria-hidden="true"></i></span>
					<select name="occ" id="occ" style="width: 150px;">
						<option>請選擇你職業</option>
						<option>學生</option>
						<option>軍警</option>
						<option>公務人員</option>
						<option>教育</option>
						<option>商</option>
						<option>工</option>
						<option>農</option>
						<option>醫療</option>
						<option>服務業</option>
						<option>家管</option>
						<option>退休</option>
					</select>
					<div class="clear"></div>
				</div>
				<!--是否有身心障礙-->
				<div class="w3l-user">
					<span><i class="fa fa-briefcase w3l-1" aria-hidden="true"></i></span>
					<select name="ICD" id="ICD" style="width: 150px;">
						<option>是否有身心障礙疾病</option>
						<option>是</option>
						<option>否</option>
	
					</select>
					<div class="clear"></div>
				</div>
				<div class="w3l-btn">
					<input type="submit" id="edit_done" onclick="edit_done()" disabled name="button" value="確認修改" />
				</div>
	
			</div>
		</div>
		</div>
	<!--主程式-->
	<script>
		var userId = "";
		var liffID = '1655371574-Gred1EMe';
		async function main() {
			await liff.init({
				liffId: liffID
			})
			var find = '';
			if (liff.isLoggedIn()) {
				liff.getProfile()
					.then(profile => {
						document.getElementById("profile_img").src = profile.pictureUrl
						document.getElementById("username").append(profile.displayName)
						document.getElementById("UID").append(profile.userId)
						userId = profile.userId;
						firebase.database().ref('User/').on("value", function (snapshot) {

							console.log(userId);
							snapshot.forEach(function (item) {
								//console.log(item.val().userID);
								if (item.val().userID === userId) {
									console.log("找到了")
									find = "0";

								}
							})
						})
					})
				setTimeout(show_btn, 2000);

				function show_btn() {
					document.getElementById("login_btn").style.display = "block";
				}

				function close_window() {
					setTimeout(function () {
						liff.closeWindow();
					}, 3000);
				}
				login = function () {


					if (find === "1") {
						var clock = 3;

						function reciprocal() {
							document.getElementById("login_result").innerHTML =
								`<font size="6" color="#008000">已成功登錄，` +
								clock + `秒後將關閉此畫面</font>`;
							setTimeout(reciprocal, 1000);
							clock -= 1;
						}
						reciprocal();
						document.getElementById("login_btn").style.display = "none";
						close_window();

					} else {
					

						
							document.getElementById("login_result").innerHTML =
								`<font size="6" color="#ff0000">失敗 ! 請您先加入導覽通</font>`;
						
						
					
						
						document.getElementById("login_page").style.display = "none";

						document.getElementById("profile").style.display = "block";
					
					}

				}
			} else {
				liff.login()

			}
		}
		main()
	</script>







</body>

</html>