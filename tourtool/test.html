<!DOCTYPE html>
<html>

<head>
  <!-- 利用Google Visualization讀取Google Sheet https://www.labnol.org/code/google-sheet-d3js-visualization-200608 -->
  <script src="https://www.gstatic.com/charts/loader.js"></script>

  <!--//////init firebase-->
  <script src="/firebase-app.js"></script>
  <script src="/firebase-analytics.js"></script>
  <script src="/firebase-database.js"></script>
  <script>
    //firebase init app
    var firebaseConfig = {
      apiKey: "AIzaSyBXd4P9GdCXeiWD5n-VZlpVMsDCFoOUDYM",
      authDomain: "forchartjs.firebaseapp.com",
      databaseURL: "https://forchartjs.firebaseio.com"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
  </script>
  <script>
    async function main() {
      //await getlocation()
      firebase.database().ref('Map/map_description').once("value", function (snapshot) {

       
        var v 
        snapshot.forEach(function (item) {
           v = item.val()
          console.log(v);
          console.log(JSON.parse(v))

        })
      })

    }

    function getlocation() {
      google.charts.load('current', {
        packages: ['corechart', 'bar']
      });
      google.charts.setOnLoadCallback(init);
      var url = 'https://docs.google.com/spreadsheets/d/1MGvhSlXbOvM7Uoe3hxNcF261gdCJ4lOsZybCL8UD5R8/gviz/tq?sheet=' +
        'map_ Introduction2';
      google.charts.setOnLoadCallback(init);
      var target_gsheet_class_once = 'gsheet';

      function init() {
        // 要讀取的試算表，必須在雲端硬碟設定知道連結的使用者都能查看，然後在開啟該試算表的瀏覽器網址列之網址複製於此。

        var query = new google.visualization.Query(url);
        query.setQuery('select *');
        str = query.send(processSheetsData);

      }

      function processSheetsData(response) {
        var data = response.getDataTable();
        var columns = data.getNumberOfColumns();
        var rows = data.getNumberOfRows();
        var str = "";
        var gsheetClass = document.getElementsByClassName(target_gsheet_class_once)[0];
        // if (gsheetClass.outerHTML) {
        for (var r = 0; r < rows; r++) {
          if (data.getFormattedValue(r, 0) === '@') str += '[{';
          console.log("開頭")




          str += `"id": "` + data.getFormattedValue(r, 1) + `",
                                      "title" : "` + data.getFormattedValue(r, 2) + `",
                                      "desctiption" : "` + data.getFormattedValue(r, 3) + `",
                                      "camera": {` + ` "center": [` + data.getFormattedValue(r, 4) + `,` + data
            .getFormattedValue(r, 5) + `],
                                      "bearing": -8.9,
                        							"zoom": 17.68
                                      }},{`
          if (data.getFormattedValue(r, 0) === '#')
            str = str.substring(0, str.length - 2) + ']'


        }



        console.log(str);

        firebase.database().ref('Map/').update({
          map_description: str,
        })


      }

    }
    main()
  </script>

</head>

<body>

</body>

</html>

[{\"id\": \"1\",\n \"title\" : \"綜合大樓\",\n \"desctiption\" : \"綜合大樓啦\",\n \"camera\": { \"center\":
[120.6726268,24.12179219],\n \"bearing\": -8.9,\n \t\t\t\t\t\t\t\"zoom\": 17.68\n }},{\"id\": \"2\",\n \"title\" :
\"社館大樓\",\n \"desctiption\" : \"社館大樓在這哦\",\n \"camera\": { \"center\": [120.6731847,24.12098925],\n \"bearing\": -8.9,\n
\t\t\t\t\t\t\t\"zoom\": 17.68\n }},{\"id\": \"3\",\n \"title\" : \"中興湖\",\n \"desctiption\" : \"中興湖很多鵝\",\n \"camera\":
{ \"center\": [120.674204,24.12094],\n \"bearing\": -8.9,\n \t\t\t\t\t\t\t\"zoom\": 17.68\n }}]